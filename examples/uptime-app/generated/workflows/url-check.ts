// generated/workflows/url-check.ts
// Auto-generated by compile-workflow skill - do not edit directly
import { z } from "zod";
import { Workflow } from "0pflow";
import { httpHead } from "../../src/nodes/http-head.js";

// Input schema
const UrlCheckInputSchema = z.object({
  url: z.string(),
  timeout_ms: z.number().optional().default(5000),
});
type UrlCheckInput = z.infer<typeof UrlCheckInputSchema>;

// Output schema
const UrlCheckOutputSchema = z.object({
  status_code: z.number().nullable(),
  response_time_ms: z.number(),
  error: z.string().nullable(),
  checked_at: z.string(),
});
type UrlCheckOutput = z.infer<typeof UrlCheckOutputSchema>;

export const urlCheck = Workflow.create({
  name: "url-check",
  version: 1,
  inputSchema: UrlCheckInputSchema,
  outputSchema: UrlCheckOutputSchema,

  async run(ctx, inputs: UrlCheckInput): Promise<UrlCheckOutput> {
    // Task 1: Fetch URL
    // Make an HTTP HEAD request to the URL and capture the response.
    const response = await ctx.run(httpHead, {
      url: inputs.url,
      timeout_ms: inputs.timeout_ms,
    });

    return {
      status_code: response.status_code,
      response_time_ms: response.response_time_ms,
      error: response.error,
      checked_at: response.checked_at,
    };
  },
});
